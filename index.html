<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Future Grammar Mastery</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
  /* -----------------------------------------------------------
   GLOBAL COLORS & VARIABLES
----------------------------------------------------------- */
:root {
  --bg: #0099cc;
  --card-bg: #555555;
  --text: #ffffff;
  --btn-cyan: #00ffff;
  --btn-yellow: #ffb703;
  --btn-red: #d00000;
  --btn-purple: #c77dff;
  --bar-bg: #002b36;
  --bar-fill: #00ff99;
  --accent: #00e5ff; /* Manga hero neon cyan */
}

/* -----------------------------------------------------------
   GLOBAL RESET
----------------------------------------------------------- */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* -----------------------------------------------------------
   APP LAYOUT
----------------------------------------------------------- */
.app {
  max-width: 960px;
  margin: auto;
  padding: 20px;
}

header {
  text-align: center;
  margin-bottom: 20px;
}

header h1 {
  font-size: 2.2rem;
  margin: 0;
  text-shadow: 0 0 10px #000;
}

header p {
  margin: 6px 0 12px;
}

/* -----------------------------------------------------------
   NAME + BUTTON ROW
----------------------------------------------------------- */
.top-row {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: 10px;
  align-items: center;
}

.name-box {
  display: flex;
  gap: 6px;
  align-items: center;
  background: #004b63;
  padding: 6px 10px;
  border-radius: 10px;
  box-shadow: 0 0 6px #00000055;
}

.name-box input {
  border: none;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 0.9rem;
  outline: none;
  min-width: 160px;
}

.warning {
  color: #ffdddd;
  font-size: 0.85rem;
  min-height: 18px;
  text-align: center;
  margin-top: 4px;
}

/* -----------------------------------------------------------
   BUTTONS
----------------------------------------------------------- */
.controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 8px #00000055;
  font-size: 0.95rem;
}

.btn.cyan { background: var(--btn-cyan); color: #000; }
.btn.yellow { background: var(--btn-yellow); color: #000; }
.btn.red { background: var(--btn-red); color: #fff; }
.btn.purple { background: var(--btn-purple); color: #000; }

/* -----------------------------------------------------------
   STATS BAR
----------------------------------------------------------- */
.stats {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.stat-box {
  background: #004b63;
  padding: 8px 12px;
  border-radius: 10px;
  min-width: 110px;
  text-align: center;
  box-shadow: 0 0 6px #00000055;
}

.stat-label {
  font-size: 0.8rem;
  opacity: 0.9;
}

.stat-value {
  font-size: 1rem;
  font-weight: 600;
}

/* -----------------------------------------------------------
   PROGRESS BAR
----------------------------------------------------------- */
.progress-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 180px;
}

.progress-label {
  font-size: 0.85rem;
}

.progress-bar {
  position: relative;
  width: 100%;
  height: 22px;
  background: var(--bar-bg);
  border-radius: 999px;
  overflow: hidden;
  border: 2px solid #00ffffaa;
}

.progress-fill {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--bar-fill), #00ffff);
  transition: width 0.25s ease-out;
}

/* -----------------------------------------------------------
   MAIN CARD
----------------------------------------------------------- */
.card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 12px #00000088;
}

.prompt {
  font-size: 1.2rem;
  margin-bottom: 10px;
  text-align: center;
  font-weight: 600;
}

/* -----------------------------------------------------------
   INTERACTION AREA
----------------------------------------------------------- */
.interaction {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  min-height: 50px;
  margin-bottom: 18px;
  padding-bottom: 10px;
  border-bottom: 2px solid #00ffff55;
}

/* -----------------------------------------------------------
   WORD BANK
----------------------------------------------------------- */
.word-bank-container {
  background-color: #1f1f1f;
  padding: 14px;
  border-radius: 12px;
  margin-top: 12px;
  margin-bottom: 12px;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.35);
  min-height: 52px;
}

.word-bank-item {
  background-color: #ffffff;
  color: #000000;
  border: 2px solid #444444;
  padding: 10px 16px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 1.05rem;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
  margin-right: 10px;
  margin-bottom: 10px;
  display: inline-block;
  user-select: none;
}

.word.selected {
  background: #333333;
  color: #ffffff;
  border: 2px solid #000000;
  border-radius: 10px;
  padding: 10px 16px;
  font-weight: 600;
  font-size: 1.05rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.35);
  cursor: pointer;
  user-select: none;
}

/* -----------------------------------------------------------
   FEEDBACK
----------------------------------------------------------- */
.feedback {
  margin-top: 6px;
  font-weight: 600;
  min-height: 24px;
  text-align: center;
}

.feedback.ok { color: #9cffb5; }
.feedback.no { color: #ffb3b3; }

/* -----------------------------------------------------------
   ACTION BUTTONS
----------------------------------------------------------- */
.actions {
  margin-top: 10px;
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

/* -----------------------------------------------------------
   FULL-SCREEN VICTORY OVERLAY
----------------------------------------------------------- */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.overlay.active {
  display: flex;
}

.victory-card {
  position: relative;
  background: radial-gradient(circle at center, #003b4a 0%, #000000 70%);
  border-radius: 20px;
  padding: 30px 20px;
  max-width: 600px;
  width: 90%;
  text-align: center;
  box-shadow: 0 0 30px #00e5ffaa;
  overflow: hidden;
}

/* -----------------------------------------------------------
   MANGA BURST BACKGROUND
----------------------------------------------------------- */
.burst {
  position: absolute;
  inset: -40%;
  background:
    radial-gradient(circle, rgba(0,229,255,0.4) 0, transparent 60%),
    repeating-linear-gradient(
      0deg,
      transparent 0 10px,
      rgba(0,229,255,0.4) 10px 12px
    );
  opacity: 0.7;
  mix-blend-mode: screen;
  animation: spinBurst 10s linear infinite;
}

@keyframes spinBurst {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* -----------------------------------------------------------
   MANGA HERO ANIMATION
----------------------------------------------------------- */
.hero-wrapper {
  position: relative;
  margin: 20px auto 10px;
  width: 160px;
  height: 180px;
}

.hero {
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 90px;
  height: 140px;
  transform: translateX(-50%);
  background: var(--accent);
  border-radius: 40px 40px 30px 30px;
  box-shadow: 0 0 15px #00e5ff;
  animation: heroJump 1s ease-in-out infinite;
}

.hero::before {
  content: "";
  position: absolute;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
  width: 70px;
  height: 70px;
  background: #ffffff;
  border-radius: 50%;
  box-shadow: 0 0 10px #00e5ff;
}

.hero::after {
  content: "";
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 12px;
  border-radius: 999px;
  background: #000000;
}

.hero-arm-left,
.hero-arm-right {
  position: absolute;
  top: 40px;
  width: 20px;
  height: 60px;
  background: var(--accent);
  border-radius: 20px;
  box-shadow: 0 0 8px #00e5ff;
}

.hero-arm-left {
  left: -10px;
  transform-origin: top right;
  animation: armLeft 1s ease-in-out infinite;
}

.hero-arm-right {
  right: -10px;
  transform-origin: top left;
  animation: armRight 1s ease-in-out infinite;
}

.hero-leg-left,
.hero-leg-right {
  position: absolute;
  bottom: -20px;
  width: 22px;
  height: 60px;
  background: var(--accent);
  border-radius: 20px;
  box-shadow: 0 0 8px #00e5ff;
}

.hero-leg-left {
  left: 10px;
  transform-origin: top center;
  animation: legLeft 1s ease-in-out infinite;
}

.hero-leg-right {
  right: 10px;
  transform-origin: top center;
  animation: legRight 1s ease-in-out infinite;
}

/* HERO ANIMATION KEYFRAMES */
@keyframes heroJump {
  0%, 100% { transform: translate(-50%, 0); }
  40% { transform: translate(-50%, -35px) scale(1.05); }
  60% { transform: translate(-50%, -20px); }
}

@keyframes armLeft {
  0%, 100% { transform: rotate(-20deg); }
  40% { transform: rotate(-60deg); }
}

@keyframes armRight {
  0%, 100% { transform: rotate(20deg); }
  40% { transform: rotate(60deg); }
}

@keyframes legLeft {
  0%, 100% { transform: rotate(10deg); }
  40% { transform: rotate(40deg); }
}

@keyframes legRight {
  0%, 100% { transform: rotate(-10deg); }
  40% { transform: rotate(-40deg); }
}

/* -----------------------------------------------------------
   CONFETTI
----------------------------------------------------------- */
.confetti {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
}

.confetti span {
  position: absolute;
  width: 8px;
  height: 14px;
  background: #00e5ff;
  border-radius: 2px;
  animation: confettiFall 2.5s linear infinite;
}

.confetti span:nth-child(odd) {
  background: #ffffff;
}

@keyframes confettiFall {
  0% { transform: translateY(-120%) rotate(0deg); }
  100% { transform: translateY(120%) rotate(360deg); }
}

/* -----------------------------------------------------------
   VICTORY TEXT
----------------------------------------------------------- */
.victory-title {
  position: relative;
  font-size: 1.8rem;
  font-weight: 700;
  margin-top: 10px;
  text-shadow: 0 0 10px #000;
}

.victory-sub {
  position: relative;
  margin-top: 6px;
  font-size: 1rem;
}

.victory-time {
  position: relative;
  margin-top: 10px;
  font-size: 1rem;
  font-weight: 600;
  color: #aaffff;
}
.victory-actions {
  position: relative;
  margin-top: 18px;
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

/* -----------------------------------------------------------
   RESPONSIVE
----------------------------------------------------------- */
@media (max-width: 600px) {
  header h1 { font-size: 1.8rem; }
  .hero-wrapper { width: 130px; height: 150px; }
}
  </style>
</head>

<body>

<!-- Background music -->
<audio id="bgm" loop>
<source src="audio/koala2.mp3" type="audio/mpeg">
</audio>

<!-- Victory sound -->
<audio id="winSound">
  <source src="audio/tadaa.mp3" type="audio/mpeg">
</audio>

<!-- FULL-SCREEN CELEBRATION OVERLAY -->
<div class="overlay" id="victoryOverlay">
  <div class="victory-card">
    <div class="burst"></div>
    <div class="confetti" id="confettiContainer"></div>

    <div class="hero-wrapper">
      <div class="hero">
        <div class="hero-arm-left"></div>
        <div class="hero-arm-right"></div>
        <div class="hero-leg-left"></div>
        <div class="hero-leg-right"></div>
      </div>
    </div>

    <div class="victory-title" id="victoryTitle">CONGRATULATIONS!</div>
    <div class="victory-sub" id="victorySub">You mastered 25 in a row!</div>
    <div class="victory-time" id="victoryTime">Your time: 00:00</div>

    <div class="victory-actions">
      <button class="btn cyan" onclick="restartFromVictory()">Restart</button>
      <button class="btn purple" id="musicBtnOverlay" onclick="toggleMusic()">Music: OFF</button>
    </div>
  </div>
</div>

<div class="app">
  <header>
    <h1>Future Grammar Mastery</h1>
    <p>Present Simple • Present Continuous • Will • Going to • First Conditional</p>

    <div class="top-row">
      <div class="name-box">
        <span style="font-size:0.85rem;">Name:</span>
        <input id="playerName" type="text" placeholder="Enter your name">
      </div>

      <div class="controls">
        <button class="btn cyan" onclick="startGame()">Start</button>
        <button class="btn purple" id="musicBtn" onclick="toggleMusic()">Music: OFF</button>
        <button class="btn red" onclick="resetGame()">Reset</button>
      </div>
    </div>

    <div class="warning" id="nameWarning"></div>
  </header>

  <div class="stats">
    <div class="stat-box">
      <div class="stat-label">Player</div>
      <div class="stat-value" id="displayName">---</div>
    </div>

    <div class="stat-box">
      <div class="stat-label">Streak</div>
      <div class="stat-value"><span id="streak">0</span> / 25</div>
    </div>

    <div class="progress-wrapper">
      <div class="progress-label">Progress to mastery (25 in a row)</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="stat-box">
      <div class="stat-label">Strikes</div>
      <div class="stat-value" id="strikes">0</div>
    </div>

    <div class="stat-box">
      <div class="stat-label">Time</div>
      <div class="stat-value" id="timerDisplay">00:00</div>
    </div>
  </div>

  <div class="card">
    <div class="prompt" id="prompt">Enter your name and click Start</div>

    <div class="interaction" id="interaction"></div>

    <div class="word-bank-container" id="choices"></div>

    <div class="feedback" id="feedback"></div>

    <div class="actions">
      <button class="btn red" onclick="clearWords()">Clear</button>
      <button class="btn yellow" onclick="checkAnswer()">Check</button>
    </div>
  </div>
</div>

<script>
/* -----------------------------------------------------------
   SENTENCES DATABASE
----------------------------------------------------------- */
const sentences = [
  "The train leaves at 8 a.m. tomorrow.","School starts at 9 o'clock on Monday.","The plane lands at 3:15 p.m.","The football match kicks off at noon.","The shop opens at 9 a.m. on Saturday.","The concert begins at 7 p.m. next Friday.","The ferry departs at 2 p.m.","My flight departs at 6 in the morning.","The museum closes at 6 p.m.","Our exam starts at 10 a.m. sharp.","The show begins at 7:30 tonight.","The train to Madrid leaves at 4:20.","The bus arrives at the station at 5:30.","The library opens at 8:30 a.m.","The movie starts at 6:45 tonight.",
  "School doesn't start at 8 o'clock tomorrow.","The concert doesn't begin at 6 p.m.","The bus doesn't arrive at 6:30.","My flight doesn't depart at 7 in the morning.","The shop doesn't open at 10 a.m.","The museum doesn't close at 5 p.m.","The football match doesn't kick off at 1 p.m.","The plane doesn't land at 4 p.m.","The ferry doesn't depart at 3 p.m.","Our exam doesn't start at 11 a.m.","The train doesn't leave at 9 a.m.","The library doesn't open at 9 a.m.","The movie doesn't start at 7:30 tonight.","The train to Paris doesn't leave at 5:15.","The show doesn't begin at 8:30 tonight.",
  "Does the train leave at 8 a.m. tomorrow?","Does school start at 9 o'clock on Monday?","Does the plane land at 3:15 p.m.?","Does the football match kick off at noon?","Does the shop open at 9 a.m. on Saturday?","Does the concert begin at 7 p.m. next Friday?","Does the ferry depart at 2 p.m.?","Does your flight depart at 6 in the morning?","Does the museum close at 6 p.m.?","Does our exam start at 10 a.m. sharp?","Does the show begin at 7:30 tonight?","Does the train to Madrid leave at 4:20?","Does the bus arrive at the station at 5:30?","Does the library open at 8:30 a.m.?","Does the movie start at 6:45 tonight?",
  "I am meeting my friends at the cinema tonight.","We are watching a movie tonight.","We are having dinner with our cousins tomorrow.","I am seeing the dentist on Friday.","She is visiting her grandma this weekend.","We are celebrating my birthday on Saturday.","They are going shopping after school.","She is flying to Paris next week.","She is starting her new job next week.","They are coming over for lunch tomorrow.","He is playing football on Saturday.","He is taking his driving test on Monday.","I am joining the art club next term.","They are moving house next month.","We are going to the zoo next Sunday.",
  "I am not meeting my friends tonight.","We aren't watching a movie tonight.","We aren't having dinner tomorrow.","I am not seeing the dentist on Friday.","She isn't visiting her grandma this weekend.","We aren't celebrating my birthday on Saturday.","They aren't going shopping after school.","She isn't flying to Paris next week.","She isn't starting her new job next week.","They aren't coming over for lunch tomorrow.","He isn't playing football on Saturday.","He isn't taking his driving test on Monday.","I am not joining the art club next term.","They aren't moving house next month.","We aren't going to the zoo next Sunday.",
  "Are you meeting your friends tonight?","Are we watching a movie tonight?","Are we having dinner tomorrow?","Am I seeing the dentist on Friday?","Is she visiting her grandma this weekend?","Are we celebrating your birthday on Saturday?","Are they going shopping after school?","Is she flying to Paris next week?","Is she starting her new job next week?","Are they coming over for lunch tomorrow?","Is he playing football on Saturday?","Is he taking his driving test on Monday?","Am I joining the art club next term?","Are they moving house next month?","Are we going to the zoo next Sunday?",
  "She will call you later.","He will arrive at noon.","They will go to the concert.","I will help you with your homework.","We will watch a movie tonight.","She will bake a cake.","He will fix his bike.","They will travel to Spain next summer.","We will visit grandma this weekend.","We will have a party on Friday.","I will bring the snacks.","They will win the match.","He will study for the test.","I will clean my room tomorrow.","She will join the team.",
  "I won't help you with your homework.","We won't watch a movie tonight.","She won't call you later.","He won't fix his bike.","They won't travel to Spain next summer.","We won't visit grandma this weekend.","We won't have a party on Friday.","They won't go to the concert.","He won't arrive at noon.","I won't clean my room tomorrow.","They won't win the match.","He won't study for the test.","She won't bake a cake.","I won't bring the snacks.","She won't join the team.",
  "Will she call you later?","Will he arrive at noon?","Will they go to the concert?","Will you help me with my homework?","Will we watch a movie tonight?","Will they travel to Spain next summer?","Will he fix his bike?","Will we have a party on Friday?","Will you clean your room tomorrow?","Will they win the match?","Will he study for the test?","Will she bake a cake?","Will you bring the snacks?","Will we visit grandma this weekend?","Will she join the team?",
  "I am going to visit London next week.","He is going to learn Spanish.","They are going to play video games.","We are going to bake a cake tomorrow.","We are going to travel to Italy.","She is going to study for the exam.","He is going to cook dinner tonight.","They are going to have a barbecue.","They are going to watch a movie tonight.","I am going to read a new book.","I am going to help my dad clean the garage.","We are going to visit the museum.","She is going to start a new job.","She is going to paint her room.","They are going to play football in the park.",
  "I am not going to visit London next week.","He isn't going to learn Spanish.","They aren't going to play video games.","We aren't going to bake a cake tomorrow.","We aren't going to travel to Italy.","She isn't going to study for the exam.","He isn't going to cook dinner tonight.","They aren't going to have a barbecue.","They aren't going to watch a movie tonight.","I am not going to read a new new book.","I am not going to help my dad clean the garage.","We aren't going to visit the museum.","She isn't going to start a new job.","She isn't going to paint her room.","He isn't going to play football on Saturday.",
  "Are you going to visit London next week?","Is he going to learn Spanish?","Are they going to play video games?","Are we going to bake a cake tomorrow?","Are we going to travel to Italy?","Is she going to study for the exam?","Is he going to cook dinner tonight?","Are they going to have a barbecue?","Are they going to watch a movie tonight?","Are you going to read a new book?","Are you going to help your dad clean the garage?","Are we going to visit the museum?","Is she going to start a new job?","Is she going to paint her room?","Is he going to play football on Saturday?",
  "If it rains, we will stay at home.","If it’s sunny, we will go to the beach.","If we leave now, we will catch the bus.","If you help me, I will finish faster.","If she studies, she will do well.","If they win, we will celebrate.","If he trains hard, he will win.","If we save money, we will go on holiday.","If I study hard, I will pass the exam.","If I see her, I will say hello.","If she calls me, I will answer.","If they arrive late, we will wait.","If he finishes early, he will join us.","If we go to the park, we will play football.","If I get the job, I will be happy.",
  "If it rains, we won't go outside.","If we don't leave now, we won't catch the bus.","If I don't get the job, I won't be happy.","If I don't see her, I won't say hello.","If she doesn't study, she won't do well.","If it’s not sunny, we won't go to the beach.","If we don't go to the park, we won't play football.","If I don't study, I won't pass the exam.","If you don't help me, I won't finish in time.","If they don't win, we won't celebrate.","If we don't save money, we won't go on holiday.","If he doesn't train, he won't win.","If they don't arrive, we won't wait.","If she doesn't call me, I won't know.","If he doesn't finish, he won't join us.",
  "If it rains, will we stay at home?","If you study hard, will you pass the exam?","If he trains hard, will he win?","If we save money, will we go on holiday?","If I study hard, will I pass the exam?","If she studies, will she do well?","If they win, will we celebrate?","If we go to the park, will we play football?","If I get the job, will I be happy?","If you help me, will I finish faster?","If she calls you, will you answer?","If they arrive late, will we wait?","If he finishes early, will he join us?","If we leave now, will we catch the bus?","If it’s sunny, will we go to the beach?"
];

/* -----------------------------------------------------------
   GAME STATE VARIABLES
----------------------------------------------------------- */
let current = "";
let built = [];
let streak = 0;
let strikes = 0;
const masteryGoal = 25;

let timerInterval = null;
let startTime = null;

let musicOn = false;

/* -----------------------------------------------------------
   UTILITY FUNCTIONS
----------------------------------------------------------- */
function shuffle(array) {
  // ✅ FIXED: correct Fisher–Yates shuffle loop
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
  const seconds = String(totalSeconds % 60).padStart(2, "0");
  return `${minutes}:${seconds}`;
}

function updateTimerDisplay() {
  if (!startTime) return;
  const now = Date.now();
  const diff = now - startTime;
  document.getElementById("timerDisplay").textContent = formatTime(diff);
}

function startTimer() {
  startTime = Date.now();
  clearInterval(timerInterval);
  timerInterval = setInterval(updateTimerDisplay, 500);
}

function stopTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
}

/* -----------------------------------------------------------
   MUSIC TOGGLE
----------------------------------------------------------- */
function toggleMusic() {
  const bgm = document.getElementById("bgm");
  const btn = document.getElementById("musicBtn");
  const btnOverlay = document.getElementById("musicBtnOverlay");

  if (!musicOn) {
    bgm.play().catch(() => {});
    musicOn = true;
  } else {
    bgm.pause();
    musicOn = false;
  }

  if (btn) btn.textContent = musicOn ? "Music: ON" : "Music: OFF";
  if (btnOverlay) btnOverlay.textContent = musicOn ? "Music: ON" : "Music: OFF";
}

/* -----------------------------------------------------------
   GAME START / RESET
----------------------------------------------------------- */
function startGame() {
  const nameInput = document.getElementById("playerName");
  const warning = document.getElementById("nameWarning");
  const displayName = document.getElementById("displayName");

  const name = nameInput.value.trim();
  if (name === "") {
    warning.textContent = "Please enter your name before starting.";
    return;
  }
  warning.textContent = "";
  displayName.textContent = name;

  streak = 0;
  strikes = 0;
  built = [];
  updateStats();
  document.getElementById("feedback").textContent = "";
  document.getElementById("prompt").textContent = "Build the sentence:";
  document.getElementById("interaction").innerHTML = "";
  document.getElementById("choices").innerHTML = "";

  document.getElementById("victoryOverlay").classList.remove("active");

  startTimer();
  nextSentence();
}

function resetGame() {
  stopTimer();
  startTime = null;
  document.getElementById("timerDisplay").textContent = "00:00";
  streak = 0;
  strikes = 0;
  built = [];
  updateStats();
  document.getElementById("prompt").textContent = "Enter your name and click Start";
  document.getElementById("interaction").innerHTML = "";
  document.getElementById("choices").innerHTML = "";
  document.getElementById("feedback").textContent = "";
  document.getElementById("victoryOverlay").classList.remove("active");
}

/* -----------------------------------------------------------
   UPDATE STATS
----------------------------------------------------------- */
function updateStats() {
  document.getElementById("streak").textContent = streak;
  document.getElementById("strikes").textContent = strikes;
  const fill = document.getElementById("progressFill");
  const pct = Math.max(0, Math.min(100, (streak / masteryGoal) * 100));
  fill.style.width = pct + "%";
}

/* -----------------------------------------------------------
   SENTENCE GENERATION
----------------------------------------------------------- */
function nextSentence() {
  built = [];
  const index = Math.floor(Math.random() * sentences.length);
  current = sentences[index];

  const words = shuffle(current.split(" "));

  document.getElementById("interaction").innerHTML = "";
  document.getElementById("choices").innerHTML = "";
  const fb = document.getElementById("feedback");
  fb.textContent = "";
  fb.className = "feedback";

  const choices = document.getElementById("choices");
  words.forEach(word => {
    const span = document.createElement("span");
    span.textContent = word;
    span.className = "word-bank-item";
    span.onclick = () => {
      built.push(word);
      span.style.display = "none";
      renderBuilt();
    };
    choices.appendChild(span);
  });
}

function renderBuilt() {
  const area = document.getElementById("interaction");
  area.innerHTML = "";
  built.forEach((word, i) => {
    const span = document.createElement("span");
    span.textContent = word;
    span.className = "word selected";
    span.onclick = () => {
      const removed = built.splice(i, 1)[0];
      renderBuilt();
      Array.from(document.getElementById("choices").children).forEach(btn => {
        if (btn.textContent === removed && btn.style.display === "none") {
          btn.style.display = "inline-block";
        }
      });
    };
    area.appendChild(span);
  });
}

function clearWords() {
  built = [];
  renderBuilt();
  Array.from(document.getElementById("choices").children).forEach(btn => {
    btn.style.display = "inline-block";
  });
}

/* -----------------------------------------------------------
   VICTORY SCREEN
----------------------------------------------------------- */
function showVictory() {
  stopTimer();
  document.getElementById("winSound").play().catch(() => {});

  const overlay = document.getElementById("victoryOverlay");
  const name = document.getElementById("displayName").textContent || "Player";
  document.getElementById("victoryTitle").textContent = `CONGRATULATIONS, ${name}!`;
  document.getElementById("victorySub").textContent = "You mastered 25 in a row!";

  const now = Date.now();
  const diff = startTime ? now - startTime : 0;
  document.getElementById("victoryTime").textContent = `Your time: ${formatTime(diff)}`;

  const confettiContainer = document.getElementById("confettiContainer");
  confettiContainer.innerHTML = "";
  for (let i = 0; i < 40; i++) {
    const piece = document.createElement("span");
    piece.style.left = Math.random() * 100 + "%";
    piece.style.animationDelay = (Math.random() * 2) + "s";
    confettiContainer.appendChild(piece);
  }

  overlay.classList.add("active");
}

function restartFromVictory() {
  document.getElementById("victoryOverlay").classList.remove("active");
  resetGame();
}

/* -----------------------------------------------------------
   CHECK ANSWER
----------------------------------------------------------- */
function checkAnswer() {
  if (!current) return;
  const attempt = built.join(" ");
  const feedback = document.getElementById("feedback");

  if (attempt === current) {
    feedback.textContent = "✅ Correct!";
    feedback.className = "feedback ok";
    streak++;
    updateStats();

    if (streak >= masteryGoal) {
      showVictory();
      return;
    }
    setTimeout(() => nextSentence(), 800);
  } else {
    feedback.textContent = "❌ Try again!";
    feedback.className = "feedback no";
    strikes++;
    streak = 0;
    updateStats();
    clearWords();
  }
}
</script>

</body>
</html>

