<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Future Grammar Mastery</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0099cc;
      --card:#505050;
      --panel:#004b63;
      --ink:#ffffff;

      --cyan:#00ffff;
      --yellow:#ffb703;
      --red:#d00000;
      --purple:#c77dff;
      --green:#00ff99;

      --bar:#002b36;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    .app{ max-width:980px; margin:0 auto; padding:16px; }

    header{ text-align:center; margin-bottom:12px; }
    h1{
      margin:0;
      font-size:2rem;
      font-weight:900;
      text-shadow:0 0 10px rgba(0,0,0,.35);
    }
    header p{
      margin:6px 0 10px;
      font-weight:800;
      opacity:.95;
    }

    .top-row{
      display:flex;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top:8px;
    }

    .name-box{
      background:var(--panel);
      padding:8px 10px;
      border-radius:14px;
      display:flex;
      gap:8px;
      align-items:center;
      box-shadow:0 0 10px rgba(0,0,0,.22);
    }
    .name-box span{ font-weight:900; }
    .name-box input{
      border:none;
      outline:none;
      border-radius:12px;
      padding:10px 12px;
      font-size:1rem;
      font-weight:900;
      min-width:170px;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }
    .btn{
      border:none;
      border-radius:16px;
      padding:12px 18px;
      font-weight:900;
      font-size:1rem;
      cursor:pointer;
      box-shadow:0 0 14px rgba(0,0,0,.25);
      transition:transform .12s ease, filter .12s ease;
    }
    .btn:hover{ transform:translateY(-1px); filter:brightness(1.06); }
    .btn.cyan{ background:var(--cyan); color:#001018; }
    .btn.purple{ background:var(--purple); color:#120018; }
    .btn.red{ background:var(--red); color:#fff; }
    .btn.yellow{ background:var(--yellow); color:#2b1500; }

    .warning{
      margin-top:8px;
      min-height:18px;
      font-weight:900;
      color:#ffe3e3;
    }

    /* minimal stats */
    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:stretch;
      justify-content:center;
      margin:12px 0 14px;
    }
    .stat{
      background:var(--panel);
      border-radius:14px;
      padding:10px 12px;
      min-width:140px;
      text-align:center;
      box-shadow:0 0 10px rgba(0,0,0,.22);
    }
    .stat .label{ font-size:.8rem; font-weight:900; opacity:.9; }
    .stat .value{ font-size:1.05rem; font-weight:900; margin-top:2px; }

    .progressWrap{
      flex:1;
      min-width:240px;
      background:var(--panel);
      border-radius:14px;
      padding:10px 12px;
      box-shadow:0 0 10px rgba(0,0,0,.22);
    }
    .progressWrap .label{
      text-align:left;
      font-size:.8rem;
      font-weight:900;
      opacity:.92;
    }
    .bar{
      margin-top:8px;
      height:22px;
      background:var(--bar);
      border-radius:999px;
      overflow:hidden;
      border:2px solid rgba(0,255,255,.65);
    }
    .fill{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--green), var(--cyan));
      transition:width .25s ease;
    }

    .card{
      background:var(--card);
      border-radius:18px;
      padding:18px;
      box-shadow:0 0 14px rgba(0,0,0,.35);
    }

    /* SHORT instruction ‚Äútype‚Äù */
    .miniType{
      display:inline-block;
      margin:0 auto 10px;
      padding:6px 12px;
      border-radius:999px;
      font-weight:900;
      background:rgba(0,0,0,.22);
      border:2px solid rgba(255,255,255,.18);
      box-shadow:0 0 10px rgba(0,0,0,.18);
      text-align:center;
    }
    .miniTypeWrap{ text-align:center; }

    /* BIG sentence */
    .sentenceBox{
      display:flex;
      justify-content:center;
      margin: 10px 0 14px;
    }
    .sentenceBig{
      width:100%;
      background:#0e0e0e;
      border:3px solid rgba(0,255,255,.55);
      border-radius:18px;
      padding:18px 16px;
      font-weight:900;
      font-size:1.55rem;
      line-height:1.25;
      text-align:center;
      box-shadow:0 0 16px rgba(0,0,0,.35);
      user-select:none;
    }
    @media (max-width:680px){
      .sentenceBig{ font-size:1.28rem; }
      h1{ font-size:1.7rem; }
    }

    /* ORDER */
    .interaction{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      min-height:52px;
      padding-bottom:10px;
      border-bottom:2px solid rgba(0,255,255,.32);
      margin-bottom:12px;
    }
    .word-bank{
      background:#1f1f1f;
      padding:14px;
      border-radius:16px;
      min-height:58px;
      box-shadow:0 3px 10px rgba(0,0,0,.25);
    }
    .wordItem{
      display:inline-block;
      background:#ffffff;
      color:#000;
      border:2px solid #3b3b3b;
      padding:10px 14px;
      border-radius:14px;
      font-weight:900;
      font-size:1.05rem;
      cursor:pointer;
      margin:0 10px 10px 0;
      box-shadow:0 2px 6px rgba(0,0,0,.22);
      user-select:none;
    }
    .builtWord{
      background:#111;
      color:#fff;
      border:2px solid rgba(255,255,255,.14);
      padding:10px 14px;
      border-radius:14px;
      font-weight:900;
      font-size:1.05rem;
      cursor:pointer;
      user-select:none;
      box-shadow:0 2px 8px rgba(0,0,0,.25);
    }

    /* Cards (TENSE + INTENT) */
    .cards{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:12px;
      margin-top:8px;
    }
    @media (max-width:680px){
      .cards{ grid-template-columns:1fr; }
    }

    .cardBtn{
      border:none;
      border-radius:18px;
      padding:16px 16px;
      cursor:pointer;
      font-weight:900;
      font-size:1.08rem;
      color:#0b0b0b;
      box-shadow:0 0 16px rgba(0,0,0,.28);
      border:3px solid rgba(255,255,255,.22);
      text-align:left;
      transition:transform .12s ease, filter .12s ease;
      min-height:86px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
    }
    .cardBtn:hover{ transform:translateY(-1px); filter:brightness(1.05); }
    .cardTitle{ font-size:1.14rem; font-weight:900; }
    .cardDesc{ font-size:.92rem; font-weight:800; opacity:.92; }

    /* Always different backgrounds */
    .pal0{ background:linear-gradient(135deg,#00ffff,#00ff99); }
    .pal1{ background:linear-gradient(135deg,#ffb703,#ffd166); }
    .pal2{ background:linear-gradient(135deg,#c77dff,#ff4dff); color:#160018; }
    .pal3{ background:linear-gradient(135deg,#ffffff,#b9f6ff); }
    .pal4{ background:linear-gradient(135deg,#8aff00,#00ffff); }
    .pal5{ background:linear-gradient(135deg,#ff4d6d,#ffb703); color:#180007; }

    .feedback{
      margin-top:12px;
      min-height:26px;
      text-align:center;
      font-weight:900;
      font-size:1.05rem;
    }
    .ok{ color:#a8ffd0; }
    .no{ color:#ffd1d1; }

    .actions{
      margin-top:10px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <audio id="bgm" loop preload="auto">
    <source src="audio/koala2.mp3" type="audio/mpeg">
  </audio>
  <audio id="winSound" preload="auto">
    <source src="tadaa.mp3" type="audio/mpeg">
  </audio>

  <div class="app">
    <header>
      <h1>Future Grammar Mastery</h1>
      <p>Get 25 correct in a row.</p>

      <div class="top-row">
        <div class="name-box">
          <span>Name:</span>
          <input id="playerName" type="text" placeholder="Enter your name">
        </div>

        <div class="controls">
          <button class="btn cyan" onclick="startGame()">Start</button>
          <button class="btn purple" id="musicBtn" onclick="toggleMusic()">Music: OFF</button>
          <button class="btn red" onclick="resetGame()">Reset</button>
        </div>
      </div>

      <div class="warning" id="nameWarning"></div>
    </header>

    <div class="stats">
      <div class="stat">
        <div class="label">Player</div>
        <div class="value" id="displayName">---</div>
      </div>

      <div class="stat">
        <div class="label">Streak</div>
        <div class="value"><span id="streak">0</span> / 25</div>
      </div>

      <div class="progressWrap">
        <div class="label">Progress</div>
        <div class="bar"><div class="fill" id="progressFill"></div></div>
      </div>

      <div class="stat">
        <div class="label">Time</div>
        <div class="value" id="timerDisplay">00:00</div>
      </div>
    </div>

    <div class="card">
      <div class="miniTypeWrap"><span class="miniType" id="miniType">Ready</span></div>

      <!-- Big sentence (for tense / meaning) -->
      <div class="sentenceBox hidden" id="sentenceBox">
        <div class="sentenceBig" id="sentenceBig"></div>
      </div>

      <!-- ORDER built words -->
      <div class="interaction hidden" id="interaction"></div>

      <!-- Cards area -->
      <div id="cardsArea" class="cards hidden"></div>

      <!-- Word bank -->
      <div class="word-bank hidden" id="wordBank"></div>

      <div class="feedback" id="feedback"></div>

      <div class="actions hidden" id="orderActions">
        <button class="btn red" onclick="clearWords()">Clear</button>
        <button class="btn yellow" onclick="checkOrder()">Check</button>
      </div>
    </div>
  </div>

<script>
/* ===========================================================
   BANK: sentence + tense(form) + speaking meaning(intent)
=========================================================== */
const BANK = [
  { text:"The train leaves at 8:10 tomorrow.", form:"present_simple", intent:"schedule" },
  { text:"School starts at 9 o‚Äôclock on Monday.", form:"present_simple", intent:"schedule" },
  { text:"The concert begins at 7 p.m. on Friday.", form:"present_simple", intent:"schedule" },
  { text:"The museum closes at 6 p.m.", form:"present_simple", intent:"schedule" },
  { text:"Does the match start at noon?", form:"present_simple", intent:"schedule" },

  { text:"I‚Äôm meeting my friends at 6 p.m.", form:"present_continuous", intent:"arrangement" },
  { text:"We‚Äôre having dinner together tomorrow.", form:"present_continuous", intent:"arrangement" },
  { text:"She‚Äôs seeing the dentist on Friday.", form:"present_continuous", intent:"arrangement" },
  { text:"They‚Äôre coming over for lunch tomorrow.", form:"present_continuous", intent:"arrangement" },
  { text:"Are you visiting your grandma this weekend?", form:"present_continuous", intent:"arrangement" },

  { text:"I think it will rain later.", form:"will", intent:"prediction" },
  { text:"They will probably win the match.", form:"will", intent:"prediction" },
  { text:"Maybe we will have a test tomorrow.", form:"will", intent:"prediction" },
  { text:"Don‚Äôt worry, I‚Äôll help you.", form:"will", intent:"offer_promise" },
  { text:"I won‚Äôt tell anyone. I promise.", form:"will", intent:"offer_promise" },
  { text:"Okay, I‚Äôll do it now.", form:"will", intent:"decision_now" },
  { text:"Wait‚ÄîI‚Äôll message her right now.", form:"will", intent:"decision_now" },
  { text:"The show will start in five minutes.", form:"will", intent:"announcement" },
  { text:"The results will be published tomorrow.", form:"will", intent:"announcement" },

  { text:"I‚Äôm going to study tonight.", form:"going_to", intent:"plan" },
  { text:"We‚Äôre going to meet after school.", form:"going_to", intent:"plan" },
  { text:"Are you going to watch the new episode?", form:"going_to", intent:"plan" },
  { text:"Look at those clouds! It‚Äôs going to rain.", form:"going_to", intent:"evidence_prediction" },
  { text:"That glass is going to fall!", form:"going_to", intent:"evidence_prediction" },
  { text:"You‚Äôre going to miss the bus‚Äîrun!", form:"going_to", intent:"evidence_prediction" },

  { text:"If you don‚Äôt study, you‚Äôll fail the test.", form:"first_conditional", intent:"warning_consequence" },
  { text:"If you feel tired, take a break.", form:"first_conditional", intent:"advice_suggestion" },
  { text:"If it rains, we‚Äôll stay at home.", form:"first_conditional", intent:"plan_condition" },
  { text:"If she studies, she‚Äôll do well.", form:"first_conditional", intent:"prediction_result" }
];

/* Tense cards (always 4 shown) */
const TENSE_OPTIONS = [
  { key:"present_simple", label:"Present Simple", desc:"Schedules" },
  { key:"present_continuous", label:"Present Continuous", desc:"Arrangements" },
  { key:"will", label:"Future (will)", desc:"Will / won‚Äôt" },
  { key:"going_to", label:"Be going to", desc:"Plan / evidence" },
  { key:"first_conditional", label:"First Conditional", desc:"If + present, will..." }
];

/* Meaning/intent cards by form */
const MEANING_OPTIONS = {
  will: [
    { key:"prediction", label:"Prediction", desc:"Guess / opinion" },
    { key:"offer_promise", label:"Offer / Promise", desc:"Help / promise" },
    { key:"decision_now", label:"Decision now", desc:"Made right now" },
    { key:"announcement", label:"Announcement", desc:"Official info" }
  ],
  going_to: [
    { key:"plan", label:"Plan / Intention", desc:"Already decided" },
    { key:"evidence_prediction", label:"Prediction (evidence)", desc:"Look! / evidence" },
    { key:"announcement", label:"Announcement", desc:"Official info" },     // distractor
    { key:"prediction", label:"Prediction", desc:"Guess / opinion" }         // distractor
  ],
  present_simple: [
    { key:"schedule", label:"Schedule", desc:"Timetable time" },
    { key:"arrangement", label:"Arrangement", desc:"Fixed plan" },           // distractor
    { key:"plan", label:"Plan / Intention", desc:"Already decided" },        // distractor
    { key:"prediction", label:"Prediction", desc:"Guess / opinion" }         // distractor
  ],
  present_continuous: [
    { key:"arrangement", label:"Arrangement", desc:"Fixed plan" },
    { key:"schedule", label:"Schedule", desc:"Timetable time" },             // distractor
    { key:"plan", label:"Plan / Intention", desc:"Already decided" },        // distractor
    { key:"prediction", label:"Prediction", desc:"Guess / opinion" }         // distractor
  ],
  first_conditional: [
    { key:"warning_consequence", label:"Warning", desc:"Bad result" },
    { key:"advice_suggestion", label:"Advice", desc:"Suggestion" },
    { key:"plan_condition", label:"Plan", desc:"If X, we do Y" },
    { key:"prediction_result", label:"Prediction", desc:"If X, Y happens" }
  ]
};

/* ===========================================================
   State
=========================================================== */
let currentType = "";
let currentQ = null;
let tokens = [];
let built = [];

let streak = 0;
const masteryGoal = 25;

let timerInterval = null;
let startTime = null;

let musicOn = false;

/* 3 activities */
const TYPES = ["ORDER","TENSE","MEANING"];

/* ===========================================================
   Utils
=========================================================== */
function shuffle(arr){
  for(let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function formatTime(ms){
  const s = Math.floor(ms / 1000);
  const m = String(Math.floor(s / 60)).padStart(2,"0");
  const r = String(s % 60).padStart(2,"0");
  return `${m}:${r}`;
}
function updateTimerDisplay(){
  if(!startTime) return;
  document.getElementById("timerDisplay").textContent = formatTime(Date.now() - startTime);
}
function startTimer(){
  startTime = Date.now();
  clearInterval(timerInterval);
  timerInterval = setInterval(updateTimerDisplay, 500);
}
function stopTimer(){
  clearInterval(timerInterval);
  timerInterval = null;
}
function updateStats(){
  document.getElementById("streak").textContent = streak;
  const pct = Math.max(0, Math.min(100, (streak / masteryGoal) * 100));
  document.getElementById("progressFill").style.width = pct + "%";
}
function setFeedback(text, ok=null){
  const fb = document.getElementById("feedback");
  fb.textContent = text || "";
  fb.className = "feedback";
  if(ok === true) fb.classList.add("ok");
  if(ok === false) fb.classList.add("no");
}
function show(el){ el.classList.remove("hidden"); }
function hide(el){ el.classList.add("hidden"); }
function setMiniType(txt){ document.getElementById("miniType").textContent = txt; }

function resetView(){
  setFeedback("");
  hide(document.getElementById("sentenceBox"));
  hide(document.getElementById("interaction"));
  hide(document.getElementById("cardsArea"));
  hide(document.getElementById("wordBank"));
  hide(document.getElementById("orderActions"));

  document.getElementById("cardsArea").innerHTML = "";
  document.getElementById("wordBank").innerHTML = "";
  document.getElementById("interaction").innerHTML = "";
}

/* ===========================================================
   Music
=========================================================== */
function toggleMusic(){
  const bgm = document.getElementById("bgm");
  const btn = document.getElementById("musicBtn");
  bgm.volume = 0.35;

  if(!musicOn){
    const p = bgm.play();
    if(p && p.then){
      p.then(()=>{ musicOn = true; btn.textContent = "Music: ON"; })
       .catch(()=>{ musicOn = false; btn.textContent = "Music: OFF"; });
    } else {
      musicOn = true; btn.textContent = "Music: ON";
    }
  } else {
    bgm.pause();
    musicOn = false;
    btn.textContent = "Music: OFF";
  }
}

/* ===========================================================
   Start / Reset
=========================================================== */
function startGame(){
  const name = document.getElementById("playerName").value.trim();
  if(!name){
    document.getElementById("nameWarning").textContent = "Please enter your name before starting.";
    return;
  }
  document.getElementById("nameWarning").textContent = "";
  document.getElementById("displayName").textContent = name;

  streak = 0;
  updateStats();
  setFeedback("");
  document.getElementById("bgm").load();

  startTimer();
  nextQuestion();
}

function resetGame(){
  stopTimer();
  startTime = null;
  document.getElementById("timerDisplay").textContent = "00:00";

  streak = 0;
  updateStats();

  currentQ = null;
  tokens = [];
  built = [];

  setMiniType("Ready");
  resetView();

  const bgm = document.getElementById("bgm");
  bgm.pause();
  musicOn = false;
  document.getElementById("musicBtn").textContent = "Music: OFF";
}

/* ===========================================================
   Next question (shuffle)
=========================================================== */
function nextQuestion(){
  built = [];
  resetView();

  currentType = TYPES[Math.floor(Math.random()*TYPES.length)];
  currentQ = BANK[Math.floor(Math.random()*BANK.length)];
  tokens = currentQ.text.split(" ");

  if(currentType === "ORDER"){
    setMiniType("Order words");
    renderOrder(currentQ.text);
    return;
  }
  if(currentType === "TENSE"){
    setMiniType("Verb tense");
    showBigSentence(currentQ.text);
    renderTenseCards(currentQ.form);
    return;
  }
  setMiniType("Speaker meaning");
  showBigSentence(currentQ.text);
  renderMeaningCards(currentQ.form, currentQ.intent);
}

/* BIG sentence */
function showBigSentence(text){
  document.getElementById("sentenceBig").textContent = text;
  show(document.getElementById("sentenceBox"));
}

/* ===========================================================
   ORDER
=========================================================== */
function renderOrder(){
  const interaction = document.getElementById("interaction");
  const bank = document.getElementById("wordBank");
  show(interaction); show(bank); show(document.getElementById("orderActions"));

  bank.innerHTML = "";
  const words = shuffle([...tokens]);

  words.forEach(w=>{
    const b = document.createElement("span");
    b.className = "wordItem";
    b.textContent = w;
    b.onclick = ()=>{
      built.push(w);
      b.style.display = "none";
      renderBuiltWords();
    };
    bank.appendChild(b);
  });

  renderBuiltWords();
}

function renderBuiltWords(){
  const area = document.getElementById("interaction");
  area.innerHTML = "";
  built.forEach((w,i)=>{
    const chip = document.createElement("span");
    chip.className = "builtWord";
    chip.textContent = w;
    chip.onclick = ()=>{
      const removed = built.splice(i,1)[0];
      Array.from(document.getElementById("wordBank").children).forEach(el=>{
        if(el.textContent === removed && el.style.display === "none"){
          el.style.display = "inline-block";
        }
      });
      renderBuiltWords();
    };
    area.appendChild(chip);
  });
}

function clearWords(){
  built = [];
  renderBuiltWords();
  Array.from(document.getElementById("wordBank").children).forEach(el=>{
    el.style.display = "inline-block";
  });
}

function checkOrder(){
  if(!currentQ) return;
  const attempt = built.join(" ");
  grade(attempt === currentQ.text);
}

/* ===========================================================
   TENSE cards (4 options random)
=========================================================== */
function pickPaletteClass(i){
  const pals = ["pal0","pal1","pal2","pal3","pal4","pal5"];
  return pals[i % pals.length];
}

function renderTenseCards(correctForm){
  const cards = document.getElementById("cardsArea");
  show(cards);
  cards.innerHTML = "";

  const pool = shuffle([...TENSE_OPTIONS]);
  const correct = pool.find(x => x.key === correctForm) || TENSE_OPTIONS[0];

  const others = pool.filter(x => x.key !== correctForm).slice(0,3);
  const options = shuffle([correct, ...others]);

  options.forEach((o, idx)=>{
    const btn = document.createElement("button");
    btn.className = "cardBtn " + pickPaletteClass(idx);
    btn.innerHTML = `<div class="cardTitle">${o.label}</div><div class="cardDesc">${o.desc}</div>`;
    btn.onclick = ()=> grade(o.key === correctForm);
    cards.appendChild(btn);
  });
}

/* ===========================================================
   MEANING cards (always 4)
=========================================================== */
function renderMeaningCards(form, correctIntent){
  const cards = document.getElementById("cardsArea");
  show(cards);
  cards.innerHTML = "";

  let options = (MEANING_OPTIONS[form] || []).slice(0,4);
  options = shuffle(options);

  options.forEach((o, idx)=>{
    const btn = document.createElement("button");
    btn.className = "cardBtn " + pickPaletteClass(idx);
    btn.innerHTML = `<div class="cardTitle">${o.label}</div><div class="cardDesc">${o.desc}</div>`;
    btn.onclick = ()=> grade(o.key === correctIntent, correctIntent);
    cards.appendChild(btn);
  });
}

/* ===========================================================
   Grade
=========================================================== */
function prettyIntent(key){
  return (key||"").replaceAll("_"," ").toUpperCase();
}

function grade(correct, correctIntent=null){
  if(correct){
    setFeedback("‚úÖ Correct!", true);
    streak++;
    updateStats();

    if(streak >= masteryGoal){
      try{ document.getElementById("winSound").play().catch(()=>{}); }catch(e){}
      setFeedback("üèÜ Mastery! 25 in a row!", true);
      return;
    }
    setTimeout(nextQuestion, 550);
  } else {
    streak = 0;
    updateStats();

    if(currentType === "MEANING" && correctIntent){
      setFeedback("‚ùå Try again! Correct: " + prettyIntent(correctIntent), false);
    } else {
      setFeedback("‚ùå Try again!", false);
    }

    if(currentType === "ORDER"){
      clearWords();
    }
  }
}

window.addEventListener("load", ()=>{
  document.getElementById("bgm").volume = 0.35;
  setMiniType("Ready");
});
</script>
</body>
</html>
